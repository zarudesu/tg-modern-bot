# üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

## –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ù–∏–∫–∞–∫–∏—Ö hardcoded —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–æ–¥–µ
- .env —Ñ–∞–π–ª—ã –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ git

### üîí –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### üö´ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection —á–µ—Ä–µ–∑ ORM
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è markdown —Ç–µ–∫—Å—Ç–∞

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env):
```env
# –ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ git!
TELEGRAM_TOKEN=your_secret_token
ADMIN_USER_ID=your_admin_id

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞
WEBHOOK_SECRET=random_secret_string
SESSION_TIMEOUT=3600
```

### Rate Limiting:
```env
RATE_LIMIT_DEFAULT=10/minute
RATE_LIMIT_SEARCH=30/minute
RATE_LIMIT_ADMIN=100/minute
```

## –£—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞

### üë§ –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:
- `/start`, `/help` - –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/journal`, `/history` - –∂—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç
- –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

### üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã:
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã +
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- Email –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è daily tasks
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:
```python
@router.message(Command("admin_command"))
async def admin_only(message: Message):
    if message.from_user.id not in settings.admin_user_id_list:
        await message.answer("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤")
        return
    # –ê–¥–º–∏–Ω—Å–∫–∞—è –ª–æ–≥–∏–∫–∞
```

## –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

### SQL Injection:
```python
# ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ - —á–µ—Ä–µ–∑ ORM
result = await session.execute(
    select(User).where(User.telegram_id == user_id)
)

# ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ - –Ω–∏–∫–æ–≥–¥–∞ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—Ç—å
# query = f"SELECT * FROM users WHERE id = {user_id}"
```

### XSS –≤ Markdown:
```python
def escape_markdown_v2(text: str) -> str:
    """–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤"""
    escape_chars = ['\\', '`', '*', '_', '{', '}', '[', ']', 
                   '(', ')', '#', '+', '-', '.', '!', '|', '~', '>']
    for char in escape_chars:
        text = text.replace(char, f'\\{char}')
    return text
```

### Rate Limiting:
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ middleware
class RateLimitMiddleware(BaseMiddleware):
    async def __call__(self, handler, event, data):
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
        if await self.is_rate_limited(event.from_user.id):
            return  # –ë–ª–æ–∫–∏—Ä—É–µ–º
        return await handler(event, data)
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
```python
# –£—Å–ø–µ—à–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
bot_logger.info(f"User {user_id} executed command {command}")

# –ü–æ–ø—ã—Ç–∫–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è
bot_logger.warning(f"Non-admin user {user_id} tried admin function")

# –û—à–∏–±–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
bot_logger.error(f"Rate limit exceeded for user {user_id}")
```

### –ß—Ç–æ –ù–ï –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
- ‚ùå –¢–æ–∫–µ–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏
- ‚ùå –ü–æ–ª–Ω—ã–µ email –∞–¥—Ä–µ—Å–∞ (—Ç–æ–ª—å–∫–æ –¥–æ–º–µ–Ω)
- ‚ùå –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –°–µ–∫—Ä–µ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### Docker Secrets (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ):
```yaml
# docker-compose.prod.yml
services:
  telegram-bot:
    secrets:
      - telegram_token
      - database_password
    environment:
      TELEGRAM_TOKEN_FILE: /run/secrets/telegram_token

secrets:
  telegram_token:
    external: true
  database_password:
    external: true
```

### Vault –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:
```python
import hvac

client = hvac.Client(url='https://vault.company.com')
secret = client.secrets.kv.v2.read_secret_version(
    path='telegram-bot/production'
)
```

## –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Firewall –ø—Ä–∞–≤–∏–ª–∞:
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow ssh
sudo ufw allow 443/tcp  # HTTPS
sudo ufw deny 5432/tcp  # PostgreSQL (—Ç–æ–ª—å–∫–æ internal)
```

### SSL/TLS:
```bash
# Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
certbot certonly --standalone -d your-bot-domain.com
```

### Webhook –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
```python
@app.route("/webhook", methods=["POST"])
async def webhook_handler(request):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
    if not verify_webhook_signature(request):
        return web.Response(status=401)
    # –û–±—Ä–∞–±–æ—Ç–∫–∞
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ê–ª–µ—Ä—Ç—ã:
- –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ rate limits
- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –û—à–∏–±–∫–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

### –ú–µ—Ç—Ä–∏–∫–∏:
```python
# –°—á–µ—Ç—á–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
security_events = {
    'failed_auth': 0,
    'rate_limit_hits': 0,
    'admin_actions': 0
}
```

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ß—Ç–æ –±—ç–∫–∞–ø–∏—Ç—å:
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–æ)
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úÖ –õ–æ–≥–∏ (last 30 days)

### –ß—Ç–æ –ù–ï –±—ç–∫–∞–ø–∏—Ç—å:
- ‚ùå .env —Ñ–∞–π–ª—ã
- ‚ùå –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
- ‚ùå Cache –¥–∞–Ω–Ω—ã–µ

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤:
```bash
# GPG —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
gpg --symmetric --cipher-algo AES256 backup.sql
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ**: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. **–ï–∂–µ–º–µ—Å—è—á–Ω–æ**: —Ä–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
3. **–ï–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ**: –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip-audit

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
docker scout cves
```

## Incident Response

### –ü—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏:
1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**: –æ—Ç–æ–∑–≤–∞—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã
2. **–í —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞**: —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –ë–î
3. **–í —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è**: –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –ª–æ–≥–æ–≤

### –ö–æ–Ω—Ç–∞–∫—Ç—ã:
- Telegram: —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤
- Email: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã

## Compliance

### GDPR —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏–π
- –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ê—É–¥–∏—Ç –ª–æ–≥–∏:
```python
audit_logger.info({
    'action': 'user_data_deleted',
    'user_id': user_id,
    'admin_id': admin_id,
    'timestamp': datetime.utcnow()
})
```

## –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º:
- [ ] –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] .env –¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –°–µ–∫—Ä–µ—Ç—ã —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –î–æ—Å—Ç—É–ø—ã –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

–ü–æ–º–Ω–∏—Ç–µ: **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –∞ –Ω–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ!**
