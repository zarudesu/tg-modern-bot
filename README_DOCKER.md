# üê≥ Docker Development Guide

## –ü–æ—á–µ–º—É –∫–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π?

**TL;DR:** –ö–æ–¥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –í–ù–£–¢–†–ò Docker –æ–±—Ä–∞–∑–∞, –∞ –Ω–µ –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ volume. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω—É–∂–Ω–æ **–ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ + –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**.

---

## üéØ Quick Reference

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Python –∫–æ–¥–∞:

```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Makefile:
make bot-rebuild-clean        # –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–æ—Ç
make full-rebuild-clean       # –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –≤—Ä—É—á–Ω—É—é:
docker-compose build --no-cache telegram-bot
docker-compose up -d --force-recreate telegram-bot
```

### ‚ùå –ù–ï –†–ê–ë–û–¢–ê–ï–¢:

```bash
docker-compose restart telegram-bot       # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –°–¢–ê–†–´–ô –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose build telegram-bot         # –°–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑, –Ω–æ –ù–ï –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose up -d telegram-bot         # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```

---

## üìö –ü–æ–ª–Ω—ã–π Workflow

### –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–í –Ω–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:
- **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è volume mount** –¥–ª—è –∫–æ–¥–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–æ–≤ –∏ .env)
- –ö–æ–¥ **–∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –í –æ–±—Ä–∞–∑** –ø—Ä–∏ —Å–±–æ—Ä–∫–µ (—Å–º. Dockerfile)
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–ø–∏—é** –∫–æ–¥–∞ –∏–∑ –æ–±—Ä–∞–∑–∞

```yaml
# docker-compose.yml
volumes:
  - ./logs:/app/logs        # ‚úÖ –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
  - ./.env:/app/.env:ro     # ‚úÖ –ú–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è
  # ‚ùå –ö–æ–¥ –ù–ï –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è!
```

### 3-—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞:

```bash
# –®–∞–≥ 1: –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ
vim app/modules/task_reports/handlers/preview.py

# –®–∞–≥ 2: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑ (–ë–ï–ó –∫—ç—à–∞!)
docker-compose build --no-cache telegram-bot

# –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–∑ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
docker-compose up -d --force-recreate telegram-bot
```

### –ü–æ—á–µ–º—É `--force-recreate`?

| –ö–æ–º–∞–Ω–¥–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥? |
|---------|-----------|----------------|
| `restart` | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –°–£–©–ï–°–¢–í–£–Æ–©–ò–ô –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | ‚ùå –ù–µ—Ç |
| `up -d` | –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç | ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π |
| `up -d --force-recreate` | –£–î–ê–õ–Ø–ï–¢ —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä + —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π | ‚úÖ –î–∞! |

---

## üõ†Ô∏è Makefile –ö–æ–º–∞–Ω–¥—ã

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è (–ø—Ä–æ—â–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

```bash
# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –±–æ—Ç–∞ (–ë–î —É–∂–µ –∑–∞–ø—É—â–µ–Ω–∞)
make bot-rebuild-clean

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ (–ë–î + Redis + Bot)
make full-rebuild-clean

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
make bot-logs
make full-logs

# –°—Ç–∞—Ç—É—Å
make status
```

### –ß—Ç–æ –¥–µ–ª–∞—é—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º:

```makefile
bot-rebuild-clean:
    docker-compose -f docker-compose.bot.yml build --no-cache
    docker-compose -f docker-compose.bot.yml up -d --force-recreate
```

---

## üéì –ü–æ–ª–µ–∑–Ω—ã–µ Docker –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∫–æ–¥ –æ–±–Ω–æ–≤–∏–ª—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec telegram-bot-app-full cat /app/app/modules/task_reports/handlers/preview.py | grep "map_workers"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Python –∏–º–ø–æ—Ä—Ç—ã
docker exec telegram-bot-app-full python -c "from app.modules.task_reports.utils import map_workers_to_display_names; print(map_workers_to_display_names(['zardes']))"
```

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f telegram-bot
docker logs telegram-bot-app-full -f

# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it telegram-bot-app-full bash

# –°–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps
```

### –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–∫–æ–≥–¥–∞ –≤—Å–µ —Å–ª–æ–º–∞–ª–æ—Å—å):

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
docker-compose down

# –£–¥–∞–ª–∏—Ç—å –æ–±—Ä–∞–∑—ã
docker rmi telegram-bot-telegram-bot

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω—É–ª—è
docker-compose build --no-cache
docker-compose up -d --force-recreate
```

---

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: Local vs Docker

### Local Development (bot_manager.sh)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫: `make dev-restart`
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ù—É–∂–µ–Ω Python 3.11 –ª–æ–∫–∞–ª—å–Ω–æ
- ‚ùå –ù—É–∂–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ venv

**Workflow:**
```bash
# –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥
vim app/handlers/start.py

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å - –í–°–Å!
make dev-restart
```

### Docker Development

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ä–µ–¥–∞
- ‚úÖ –ù–µ –Ω—É–∂–µ–Ω Python –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ Production-like –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚ùå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

**Workflow:**
```bash
# –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥
vim app/handlers/start.py

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ò –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
make bot-rebuild-clean
```

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á—Ç–æ?

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `make bot-rebuild-clean`:
- ‚úÖ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Python –∫–æ–¥–∞
- ‚úÖ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (requirements.txt)
- ‚úÖ –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è Dockerfile

### –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ `docker-compose restart`:
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ .env
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î (–Ω–µ —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞)

### –ù—É–∂–µ–Ω `--force-recreate` –Ω–æ –ù–ï `--no-cache`:
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ docker-compose.yml (–ø–æ—Ä—Ç—ã, volumes, env vars)

---

## üìù Checklist –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- [ ] –ò–∑–º–µ–Ω–∏–ª–∏ Python –∫–æ–¥ ‚Üí `make bot-rebuild-clean`
- [ ] –ò–∑–º–µ–Ω–∏–ª–∏ requirements.txt ‚Üí `make bot-rebuild-clean`
- [ ] –ò–∑–º–µ–Ω–∏–ª–∏ .env ‚Üí `docker-compose restart telegram-bot`
- [ ] –ò–∑–º–µ–Ω–∏–ª–∏ docker-compose.yml ‚Üí `docker-compose up -d --force-recreate`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª–∏ –ª–æ–≥–∏ ‚Üí `make bot-logs`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–∏ –≤ Telegram

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–ö–æ–¥ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

```bash
# –†–µ—à–µ–Ω–∏–µ 1: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
make bot-rebuild-clean

# –†–µ—à–µ–Ω–∏–µ 2: –í—Ä—É—á–Ω—É—é —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
docker-compose build --no-cache telegram-bot
docker-compose up -d --force-recreate telegram-bot
docker logs telegram-bot-app-full --tail 50
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è"

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs telegram-bot-app-full

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker ps -a | grep telegram-bot

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ + –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è"

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ë–î –æ—Ç–¥–µ–ª—å–Ω–æ
make db-up

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å
docker network ls | grep telegram-bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker exec telegram-bot-app-full ping postgres
```

---

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [CLAUDE.md](CLAUDE.md)
- **Makefile –∫–æ–º–∞–Ω–¥—ã:** `make help`
- **Docker Compose docs:** https://docs.docker.com/compose/

---

**Last Updated:** 2025-10-09
**Author:** Claude Code + Human
