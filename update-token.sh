#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –≤–æ –≤—Å–µ—Ö .env —Ñ–∞–π–ª–∞—Ö

echo "üîë –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞ –≤–æ –≤—Å–µ—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö"
echo "========================================================="

# –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
read -p "üìù –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π TELEGRAM_TOKEN (—Ñ–æ—Ä–º–∞—Ç: 123456789:ABC...): " NEW_TOKEN

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞
if [[ ! $NEW_TOKEN =~ ^[0-9]+:[A-Za-z0-9_-]+$ ]]; then
    echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞! –§–æ—Ä–º–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: 123456789:ABC..."
    exit 1
fi

echo "üîÑ –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –≤ —Ñ–∞–π–ª–∞—Ö..."

# –û–±–Ω–æ–≤–ª—è–µ–º .env
if [ -f ".env" ]; then
    sed -i.bak "s/TELEGRAM_TOKEN=.*/TELEGRAM_TOKEN=$NEW_TOKEN/" .env
    echo "  ‚úÖ .env –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    echo "  ‚ùå .env –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –û–±–Ω–æ–≤–ª—è–µ–º .env.dev
if [ -f ".env.dev" ]; then
    sed -i.bak "s/TELEGRAM_TOKEN=.*/TELEGRAM_TOKEN=$NEW_TOKEN/" .env.dev
    echo "  ‚úÖ .env.dev –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    echo "  ‚ùå .env.dev –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –û–±–Ω–æ–≤–ª—è–µ–º .env.prod
if [ -f ".env.prod" ]; then
    sed -i.bak "s/TELEGRAM_TOKEN=.*/TELEGRAM_TOKEN=$NEW_TOKEN/" .env.prod
    echo "  ‚úÖ .env.prod –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    echo "  ‚ùå .env.prod –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# –£–¥–∞–ª—è–µ–º –±—ç–∫–∞–ø—ã
rm -f .env.bak .env.dev.bak .env.prod.bak

echo "‚úÖ –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö!"
echo ""
echo "üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:"
echo "   make dev"
