# üìä Plane Tasks Flow Analysis - –õ–æ–≥–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á

## üéØ –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á (3-—É—Ä–æ–≤–Ω–µ–≤–∞—è)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. TELEGRAM BOT (Frontend)                                  ‚îÇ
‚îÇ    /daily_tasks ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏           ‚îÇ
‚îÇ    /daily_settings ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ email + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. USER_TASKS_CACHE_SERVICE (Background Worker)            ‚îÇ
‚îÇ    - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –≤ —Ñ–æ–Ω–µ (~5 –º–∏–Ω—É—Ç)          ‚îÇ
‚îÇ    - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞—á–∞–ª–µ/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏                        ‚îÇ
‚îÇ    - –¢–∞–±–ª–∏—Ü–∞: user_tasks_cache (–∫—ç—à –∑–∞–¥–∞—á)                  ‚îÇ
‚îÇ    - –¢–∞–±–ª–∏—Ü–∞: user_tasks_sync_status (—Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. PLANE_API_CLIENT (API Integration)                      ‚îÇ
‚îÇ    - Rate limiting: 60 req/min (1 req/sec)                  ‚îÇ
‚îÇ    - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –ª–∏–º–∏—Ç—É           ‚îÇ
‚îÇ    - –ö—ç—à –ø—Ä–æ–µ–∫—Ç–æ–≤ (4 —á–∞—Å–∞)                                  ‚îÇ
‚îÇ    - –ö—ç—à —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ + states (1 —á–∞—Å)                        ‚îÇ
‚îÇ    - Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π Flow –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç `/daily_tasks`

**–§–∞–π–ª:** `app/modules/daily_tasks/handlers.py:32`

```python
@router.message(Command("daily_tasks"))
async def cmd_daily_tasks(message: Message):
    # 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω –ø—Ä–∞–≤
    # 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ë–î
    admin_settings = daily_tasks_service.admin_settings.get(admin_id, {})
    admin_email = admin_settings.get('plane_email')

    # 3. –ï—Å–ª–∏ email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Üí –ø—Ä–æ—Å–∏–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
    if not admin_email:
        return show_setup_email_prompt()

    # 4. üöÄ –ë–´–°–¢–†–´–ô –ü–£–¢–¨: –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ö–≠–®–ê
    cached_tasks = await user_tasks_cache_service.get_cached_tasks(
        user_email=admin_email,
        max_tasks=50
    )

    # 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    sync_status = await user_tasks_cache_service.get_sync_status(admin_email)
```

### –®–∞–≥ 2: –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ó–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (sync_in_progress=True)
```python
if not cached_tasks and sync_status.sync_in_progress:
    return "‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ... –≠—Ç–æ –∑–∞–π–º–µ—Ç ~5 –º–∏–Ω—É—Ç"
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ù–µ—Ç –∑–∞–¥–∞—á –≤–æ–æ–±—â–µ
```python
if not cached_tasks:
    return "üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–¥–∞—á: 0"
```

#### –°—Ü–µ–Ω–∞—Ä–∏–π C: ‚úÖ –ó–∞–¥–∞—á–∏ –Ω–∞–π–¥–µ–Ω—ã –≤ –∫—ç—à–µ
```python
# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 –∑–∞–¥–∞—á —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
# –≠–º–æ–¥–∑–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞, —Å–æ—Å—Ç–æ—è–Ω–∏—è, —Å—Å—ã–ª–∫–∏ –Ω–∞ Plane
```

### –®–∞–≥ 3: –ü–µ—Ä–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –∫—ç—à–∞ –Ω–µ—Ç)

**–¢—Ä–∏–≥–≥–µ—Ä:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –∑–∞–¥–∞—á

**–§–∞–π–ª:** `app/services/user_tasks_cache_service.py:23`

```python
async def start_user_sync(user_email: str, telegram_user_id: int):
    # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–¥–µ—Ç –ª–∏ —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
    if sync_status and sync_status.sync_in_progress:
        return False  # –£–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

    # 2. –°–æ–∑–¥–∞–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
    sync_status.sync_in_progress = True
    sync_status.last_sync_started = datetime.now()

    # 3. üì® –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await bot.send_message(
        telegram_user_id,
        "‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–∏ –∑–∞–¥–∞—á–∏ –∏–∑ Plane.so... –≠—Ç–æ –∑–∞–π–º–µ—Ç ~5 –º–∏–Ω—É—Ç"
    )

    # 4. üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º –§–û–ù–û–í–£–Æ –∑–∞–¥–∞—á—É (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º UI)
    asyncio.create_task(self._sync_user_tasks_background(user_email))
```

### –®–∞–≥ 4: –§–æ–Ω–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á

**–§–∞–π–ª:** `app/services/user_tasks_cache_service.py:80`

```python
async def _sync_user_tasks_background(user_email: str):
    try:
        # 1. üì• –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ Plane API (–¥–æ–ª–≥–∏–π –ø—Ä–æ—Ü–µ—Å—Å!)
        tasks = await plane_api.get_user_tasks(user_email)
        # ‚è±Ô∏è –ó–∞–Ω–∏–º–∞–µ—Ç ~3-5 –º–∏–Ω—É—Ç –∏–∑-–∑–∞ rate limiting

        # 2. –§–∏–ª—å—Ç—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–±–µ–∑ done/cancelled)
        active_tasks = [t for t in tasks if t.state not in ['done', 'completed']]

        # 3. üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
        tasks_count = await self._save_tasks_to_cache(user_email, active_tasks)

        # 4. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        sync_status.sync_in_progress = False
        sync_status.last_sync_completed = datetime.now()
        sync_status.total_tasks_found = tasks_count

        # 5. üì® –£–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        await bot.send_message(
            telegram_user_id,
            f"‚úÖ –ó–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã! –ù–∞–π–¥–µ–Ω–æ: {tasks_count}"
        )

    except Exception as e:
        # ‚ùå –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—à–∏–±–∫—É –≤ –ë–î
        sync_status.last_sync_error = str(e)
        await bot.send_message(telegram_user_id, "‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")
```

## üî• Plane API - –î–µ—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞

**–§–∞–π–ª:** `app/integrations/plane_api.py:277`

### –ú–µ—Ç–æ–¥: `get_user_tasks(user_email)`

```python
async def get_user_tasks(self, user_email: str) -> List[PlaneTask]:
    """
    –î–û–õ–ì–ò–ô –ü–†–û–¶–ï–°–° (~3-5 –º–∏–Ω—É—Ç) –∏–∑-–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
    """

    async with aiohttp.ClientSession() as session:
        # –≠–¢–ê–ü 1: –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (1 –∑–∞–ø—Ä–æ—Å)
        projects = await self._get_projects(session)
        # –†–µ–∑—É–ª—å—Ç–∞—Ç –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 4 —á–∞—Å–∞

        # –≠–¢–ê–ü 2: –î–ª—è –ö–ê–ñ–î–û–ì–û –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª—É—á–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ states
        # üêå –£–ó–ö–û–ï –ú–ï–°–¢–û: –ï—Å–ª–∏ 20 –ø—Ä–æ–µ–∫—Ç–æ–≤ = 40 –∑–∞–ø—Ä–æ—Å–æ–≤
        for project in projects:
            members = await self._get_project_members(session, project_id)
            # ‚è±Ô∏è + Rate limiting delay = 1 second –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

            states = await self._get_project_states(session, project_id)
            # ‚è±Ô∏è + –µ—â–µ 1 second delay

        # –≠–¢–ê–ü 3: –°—Ç—Ä–æ–∏–º –º–∞–ø–∏–Ω–≥ user_id -> email
        user_id_to_email = {}  # –ò—â–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
        for member in all_members:
            if member['email'] == user_email:
                target_user_id = member['id']

        # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ï—Å–ª–∏ email –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —É—á–∞—Å—Ç–Ω–∏–∫–∞—Ö
        if user_email not in user_id_to_email.values():
            bot_logger.warning(f"User {user_email} NOT found in any project!")
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ü–£–°–¢–û–ô —Å–ø–∏—Å–æ–∫ (–Ω–æ –ë–ï–ó –æ—à–∏–±–∫–∏!)
            return []

        # –≠–¢–ê–ü 4: –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á–∏ –∏–∑ –ö–ê–ñ–î–û–ì–û –ø—Ä–æ–µ–∫—Ç–∞
        all_tasks = []
        for project in projects:
            # üêå –ï–©–ï –û–î–ù–û –£–ó–ö–û–ï –ú–ï–°–¢–û
            tasks = await self._get_project_issues(
                session, project_id, user_email, user_id_to_email
            )
            # ‚è±Ô∏è + 1-2 seconds –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç
            all_tasks.extend(tasks)

        return all_tasks  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
```

### Rate Limiting –º–µ—Ö–∞–Ω–∏–∑–º

**–§–∞–π–ª:** `app/integrations/plane_api.py:167`

```python
# Plane.so –ª–∏–º–∏—Ç—ã: 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
_request_delay = 1.0 —Å–µ–∫—É–Ω–¥–∞  # –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞

async def _rate_limit_delay(self):
    # –ï—Å–ª–∏ –æ—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤ (<= 5)
    if self._rate_limit_remaining <= 5:
        adaptive_delay = self._request_delay * 2  # ‚ùó –£–¥–≤–∞–∏–≤–∞–µ–º delay!
        await sleep(adaptive_delay)  # 2 —Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ 1

    # –û–±—ã—á–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    await sleep(self._request_delay)  # 1 —Å–µ–∫—É–Ω–¥–∞
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP 429 (Rate Limit Exceeded)

```python
if response.status == 429:
    retry_after = response.headers.get('Retry-After', 60)
    bot_logger.warning(f"Rate limit! Waiting {retry_after}s")
    await sleep(retry_after)  # –ñ–¥–µ–º –¥–æ —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞
```

## üêõ –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: ‚ùå –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π email ‚Üí –∑–∞–≤–∏—Å–∞–Ω–∏–µ

**–ü—Ä–∏—á–∏–Ω–∞:**
```python
# –í Plane API: –ï—Å–ª–∏ email –Ω–µ –Ω–∞–π–¥–µ–Ω
if user_email not in user_id_to_email.values():
    return []  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –±–µ–∑ –æ—à–∏–±–∫–∏
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `nonexistent@test.com`
2. Plane API –ø–µ—Ä–µ–±–∏—Ä–∞–µ—Ç –í–°–ï –ø—Ä–æ–µ–∫—Ç—ã –∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (~3-5 –º–∏–Ω)
3. –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç email ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `[]`
4. –ö—ç—à —Å–µ—Ä–≤–∏—Å: "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –Ω–∞–π–¥–µ–Ω–æ 0 –∑–∞–¥–∞—á"
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–¥–∞—á: 0" (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã!)

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å **EARLY RETURN** –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö 2-3 –ø—Ä–æ–µ–∫—Ç–æ–≤, –µ—Å–ª–∏ email –Ω–µ –Ω–∞–π–¥–µ–Ω
- –í–µ—Ä–Ω—É—Ç—å —è–≤–Ω—É—é –æ—à–∏–±–∫—É –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞
- –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é "Email –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Plane"

### –ü—Ä–æ–±–ª–µ–º–∞ 2: üî¥ Toggle notifications –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:**
```python
@router.callback_query(F.data == "toggle_notifications")
async def callback_toggle_notifications(callback: CallbackQuery):
    # ... –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ ...
    await daily_tasks_service._save_admin_settings_to_db()

    # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢: await callback.answer()
    # ‚ùå –ù–ï–¢: –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Callback –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è (–∫—Ä—É—Ç–∏—Ç—Å—è "Loading...")
- UI –∑–∞–≤–∏—Å–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```python
await callback.answer(f"‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è {'–≤–∫–ª—é—á–µ–Ω—ã' if new_state else '–æ—Ç–∫–ª—é—á–µ–Ω—ã'}")
await callback_back_to_settings(callback)  # –û–±–Ω–æ–≤–ª—è–µ–º –º–µ–Ω—é
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: ‚è±Ô∏è –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤ –Ω–∞ HTTP –∑–∞–ø—Ä–æ—Å—ã

**–ü—Ä–∏—á–∏–Ω–∞:**
```python
async with session.request(method, url, **kwargs) as response:
    # ‚ùå –ù–ï–¢ TIMEOUT –ø–∞—Ä–∞–º–µ—Ç—Ä–∞!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –ï—Å–ª–∏ Plane API –º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Üí –∂–¥–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ñ–æ–Ω–æ–≤—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

**–†–µ—à–µ–Ω–∏–µ:**
```python
timeout = aiohttp.ClientTimeout(total=30, connect=10)
async with session.request(method, url, timeout=timeout, **kwargs):
    ...
```

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã:** 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ Plane API
2. **Early return –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö email:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö 3 –ø—Ä–æ–µ–∫—Ç–æ–≤
3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å toggle_notifications:** –î–æ–±–∞–≤–∏—Ç—å `callback.answer()` –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é
4. **–£–ª—É—á—à–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É (email –Ω–µ –Ω–∞–π–¥–µ–Ω, API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
5. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å –∫—ç—à –ø—Ä–æ–µ–∫—Ç–æ–≤ —Å 4 –¥–æ 24 —á–∞—Å–æ–≤
6. **–ü—Ä–æ–≥—Ä–µ—Å—Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä:** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å "–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 5/20 –ø—Ä–æ–µ–∫—Ç–æ–≤..." –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

## üìä –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏

**–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å 20 –ø—Ä–æ–µ–∫—Ç–∞–º–∏:**

```
–ü—Ä–æ–µ–∫—Ç—ã (1 req)               = 1 —Å–µ–∫
–£—á–∞—Å—Ç–Ω–∏–∫–∏ (20 req √ó 1s)       = 20 —Å–µ–∫
States (20 req √ó 1s)           = 20 —Å–µ–∫
Issues (20 req √ó 1-2s)         = 30 —Å–µ–∫
–û–±—Ä–∞–±–æ—Ç–∫–∞ + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è         = 10 —Å–µ–∫
                              ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û                         ‚âà 81 —Å–µ–∫ (~1.5 –º–∏–Ω—É—Ç—ã)
```

**–ü—Ä–∏ adaptive delay (–±–ª–∏–∑–∫–æ –∫ –ª–∏–º–∏—Ç—É):**
```
81 —Å–µ–∫ √ó 2 = 162 —Å–µ–∫ (2.7 –º–∏–Ω—É—Ç—ã)
```

**–í—ã–≤–æ–¥:** –†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ 2-5 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ rate limiting.
